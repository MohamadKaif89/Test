<div id="lookbook"></div>

<style>
  #lookbook{
    max-width:1100px;
    margin:auto;
    padding:20px;
  }

  .lookbook-section{
    margin-bottom:60px;
    border-bottom:1px solid #eee;
    padding-bottom:30px;
  }

  .lookbook-title{
    font-size:26px;
    margin-bottom:12px;
  }

  .look-main img{
    width:100%;
    border-radius:6px;
    margin-bottom:18px;
  }

  .products{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:15px;
  }

  .product-card{
    border:1px solid #ddd;
    border-radius:6px;
    padding:10px;
    text-align:center;
    text-decoration:none;
    background:white;
    transition:box-shadow .2s;
  }

  .product-card:hover{
    box-shadow:0 0 10px rgba(0,0,0,.15);
  }

  .product-card img{
    width:100%;
    border-radius:4px;
  }

  .product-title{
    margin-top:6px;
    color:#111;
    font-size:14px;
  }

  .missing{
    border:1px dashed #bbb;
    padding:22px;
    text-align:center;
  }

  @media(max-width:768px){
    .products{grid-template-columns:1fr;}
  }
</style>

<script>
async function renderLookbook(){
  try{
    const res = await fetch('https://cdn.shopify.com/s/files/1/0582/3637/1076/files/LookBook.csv?v=1766746038');
    const text = await res.text();

    const rows = text.trim().split('\n').slice(1); // skip header
    const container = document.getElementById("lookbook");

    rows.forEach(row => {
      const cols = row.split(',');

      const lookTitle = cols[0];
      const lookImage = cols[1];
      const productHandles = cols[2]?.split('|') || [];
      const customImages = cols[3]?.split('|') || [];

      const section = document.createElement("section");
      section.className = "lookbook-section";

      section.innerHTML = `
        <h2 class="lookbook-title">${lookTitle}</h2>
        <div class="look-main">
          <img src="${lookImage}" alt="${lookTitle}">
        </div>
        <div class="products"></div>
      `;

      const grid = section.querySelector(".products");

      productHandles.forEach((handle, i) => {
        if(!handle) return;

        const customImg = customImages[i] || "";
        const productUrl = "/products/" + handle.trim();

        const card = document.createElement("a");
        card.className = "product-card";
        card.href = productUrl;

        card.innerHTML = `
          <img src="${customImg}" onerror="this.closest('.product-card').outerHTML='<div class=&quot;product-card missing&quot;>Product not available</div>'">
          <p class="product-title">${handle}</p>
        `;

        grid.appendChild(card);
      });

      container.appendChild(section);
    });

  } catch(err){
    console.error("Something went wrong", err);
  }
}

renderLookbook();
</script>
