async function getAllProducts() {
  try {
    const response = await fetch(
      "https://cdn.shopify.com/s/files/1/0582/3637/1076/files/updated-new.csv?v=1766912121"
    );
    const csvText = await response.text();
    const lines = csvText.trim().split("\n");
    // skipping header
    const productLines = lines.slice(1);
    const container = document.querySelector(".look-container");
    // going each row in csv
    for (let line of productLines) {
      const parts = line.split(",");
      const title = parts[0];
      const lookImage = parts[1];
      const handleString = parts[2];
      // Creating section wrapper
      const section = document.createElement("div");
      section.className = "look-section";
      section.innerHTML = `
        <h2 class="look-title">${title}</h2>
        <div class="look-main">
          <img src="${lookImage}" alt="${title}">
        </div>
        <div class="product-grid"></div>`;
      const gridBox = section.querySelector(".product-grid");
      // Converting handle string into array
      let handleList = [];

      if (handleString) {
        handleList = handleString
          .split("|")
          .map((item) => item.trim())
          .filter((item) => item !== "");
      }
      //Loading each product using its handle
      for (let handle of handleList) {
        try {
          const productRes = await fetch(`/products/${handle}.js`);
          if (!productRes.ok) {
            console.log("Product not found:", handle);
            continue;
          }
          const product = await productRes.json();
          const card = document.createElement("div");
          card.className = "product-card";

          card.innerHTML = `
          <a href="${product.url}"
          <div class="product-img-box">
            <img src="${product.images[0]}" alt="${product.title}">
            </div>
            </a>
            <div class="product-text-box">
            <p>${product.title}</p>
            <p>RS: ${product.price / 100}</p>
            </div>
          `;
          gridBox.appendChild(card);
        } catch (error) {
          console.log("Could not load product:", handle, error);
        }
      }
      // adding the section into container
      container.appendChild(section);
    }
  } catch (err) {
    console.log("Something went wrong loading CSV", err);
  }
}
getAllProducts();
